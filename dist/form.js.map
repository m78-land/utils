{"version":3,"sources":["/Users/lixianjie/project/openSource/utils/src/form.ts"],"sourcesContent":["import { isDom } from \"./is.js\";\nimport { AnyObject } from \"./common-type\";\n\n/**\n * 收集指定对象内带name属性的所有输入控件(input,select,textarea)的值，并按一定规则整合\n * checkbox: 选中值的value组成的数组，没有的话返回 []\n * radio: 选中项的value，没有value的话作为默认行为浏览器会返回 \"on\"\n * file: 选择的文件组成的数组，没有的话返回 []\n * 其他: 表单元素的value属性值\n * @param el\n * @returns object - 表单值\n */\nexport function form2obj(el: HTMLElement): AnyObject {\n  if (!isDom(el)) {\n    console.error(\"Please pass in the dom element\");\n    return {};\n  }\n  if (!el.querySelectorAll) {\n    console.error(\n      \"The passed in element does not support the querySelectorAll API\"\n    );\n    return {};\n  }\n  const tempObj = {};\n  let inputs: any = el.querySelectorAll(\n    \"input[name],select[name],textarea[name]\"\n  );\n  inputs = Array.prototype.slice.call(inputs);\n  inputs.forEach((v) => {\n    // name => \"\"\n    if (!v.name) return;\n\n    if (v.type === \"radio\" || v.type === \"checkbox\") {\n      if (!tempObj[v.name]) tempObj[v.name] = v.type === \"checkbox\" ? [] : \"\";\n    }\n    if (v.type === \"radio\") {\n      v.checked && (tempObj[v.name] = v.value);\n    } else if (v.type === \"checkbox\") {\n      v.checked && tempObj[v.name].push(v.value);\n    } else if (v.type === \"file\") {\n      tempObj[v.name] = Array.prototype.slice.call(v.files);\n    } else {\n      tempObj[v.name] = v.value;\n    }\n  });\n\n  return tempObj;\n}\n\n/**\n * 将一个object转为对应键值对的 FormData 对象\n * @param obj\n * @returns fd - FormData对象\n */\nexport function obj2FormData(obj): FormData {\n  const keys = Object.keys(obj);\n  const form = new FormData();\n\n  keys.forEach((key) => {\n    if (Array.isArray(obj[key])) {\n      obj[key].forEach((val) => {\n        // form.append(`${key}[]`, val)\n        form.append(key, val);\n      });\n    } else if (obj[key]) {\n      form.append(key, obj[key]);\n    }\n  });\n\n  return form;\n}\n"],"names":["isDom","form2obj","el","console","error","querySelectorAll","tempObj","inputs","Array","prototype","slice","call","forEach","v","name","type","checked","value","push","files","obj2FormData","obj","keys","Object","form","FormData","key","isArray","val","append"],"mappings":"AAAA,SAASA,KAAK,QAAQ,SAAS,CAAC;AAGhC;;;;;;;;CAQC,GACD,OAAO,SAASC,QAAQ,CAACC,EAAe,EAAa;IACnD,IAAI,CAACF,KAAK,CAACE,EAAE,CAAC,EAAE;QACdC,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAC,CAAC;QAChD,OAAO,EAAE,CAAC;KACX;IACD,IAAI,CAACF,EAAE,CAACG,gBAAgB,EAAE;QACxBF,OAAO,CAACC,KAAK,CACX,iEAAiE,CAClE,CAAC;QACF,OAAO,EAAE,CAAC;KACX;IACD,IAAME,OAAO,GAAG,EAAE,AAAC;IACnB,IAAIC,MAAM,GAAQL,EAAE,CAACG,gBAAgB,CACnC,yCAAyC,CAC1C,AAAC;IACFE,MAAM,GAAGC,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACJ,MAAM,CAAC,CAAC;IAC5CA,MAAM,CAACK,OAAO,CAAC,SAACC,CAAC,EAAK;QACpB,aAAa;QACb,IAAI,CAACA,CAAC,CAACC,IAAI,EAAE,OAAO;QAEpB,IAAID,CAAC,CAACE,IAAI,KAAK,OAAO,IAAIF,CAAC,CAACE,IAAI,KAAK,UAAU,EAAE;YAC/C,IAAI,CAACT,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,EAAER,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACE,IAAI,KAAK,UAAU,GAAG,EAAE,GAAG,EAAE,CAAC;SACzE;QACD,IAAIF,CAAC,CAACE,IAAI,KAAK,OAAO,EAAE;YACtBF,CAAC,CAACG,OAAO,IAAI,CAACV,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACI,KAAK,CAAC,CAAC;SAC1C,MAAM,IAAIJ,CAAC,CAACE,IAAI,KAAK,UAAU,EAAE;YAChCF,CAAC,CAACG,OAAO,IAAIV,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,CAACI,IAAI,CAACL,CAAC,CAACI,KAAK,CAAC,CAAC;SAC5C,MAAM,IAAIJ,CAAC,CAACE,IAAI,KAAK,MAAM,EAAE;YAC5BT,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGN,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACE,CAAC,CAACM,KAAK,CAAC,CAAC;SACvD,MAAM;YACLb,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACI,KAAK,CAAC;SAC3B;KACF,CAAC,CAAC;IAEH,OAAOX,OAAO,CAAC;CAChB;AAED;;;;CAIC,GACD,OAAO,SAASc,YAAY,CAACC,GAAG,EAAY;IAC1C,IAAMC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACD,GAAG,CAAC,AAAC;IAC9B,IAAMG,IAAI,GAAG,IAAIC,QAAQ,EAAE,AAAC;IAE5BH,IAAI,CAACV,OAAO,CAAC,SAACc,GAAG,EAAK;QACpB,IAAIlB,KAAK,CAACmB,OAAO,CAACN,GAAG,CAACK,GAAG,CAAC,CAAC,EAAE;YAC3BL,GAAG,CAACK,GAAG,CAAC,CAACd,OAAO,CAAC,SAACgB,GAAG,EAAK;gBACxB,+BAA+B;gBAC/BJ,IAAI,CAACK,MAAM,CAACH,GAAG,EAAEE,GAAG,CAAC,CAAC;aACvB,CAAC,CAAC;SACJ,MAAM,IAAIP,GAAG,CAACK,GAAG,CAAC,EAAE;YACnBF,IAAI,CAACK,MAAM,CAACH,GAAG,EAAEL,GAAG,CAACK,GAAG,CAAC,CAAC,CAAC;SAC5B;KACF,CAAC,CAAC;IAEH,OAAOF,IAAI,CAAC;CACb"}