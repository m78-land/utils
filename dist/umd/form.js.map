{"version":3,"sources":["/Users/lixianjie/project/openSource/utils/src/form.ts"],"sourcesContent":["import { isDom } from \"./is.js\";\nimport { AnyObject } from \"./common-type\";\n\n/**\n * 收集指定对象内带name属性的所有输入控件(input,select,textarea)的值，并按一定规则整合\n * checkbox: 选中值的value组成的数组，没有的话返回 []\n * radio: 选中项的value，没有value的话作为默认行为浏览器会返回 \"on\"\n * file: 选择的文件组成的数组，没有的话返回 []\n * 其他: 表单元素的value属性值\n * @param el\n * @returns object - 表单值\n */\nexport function form2obj(el: HTMLElement): AnyObject {\n  if (!isDom(el)) {\n    console.error(\"Please pass in the dom element\");\n    return {};\n  }\n  if (!el.querySelectorAll) {\n    console.error(\n      \"The passed in element does not support the querySelectorAll API\"\n    );\n    return {};\n  }\n  const tempObj = {};\n  let inputs: any = el.querySelectorAll(\n    \"input[name],select[name],textarea[name]\"\n  );\n  inputs = Array.prototype.slice.call(inputs);\n  inputs.forEach((v) => {\n    // name => \"\"\n    if (!v.name) return;\n\n    if (v.type === \"radio\" || v.type === \"checkbox\") {\n      if (!tempObj[v.name]) tempObj[v.name] = v.type === \"checkbox\" ? [] : \"\";\n    }\n    if (v.type === \"radio\") {\n      v.checked && (tempObj[v.name] = v.value);\n    } else if (v.type === \"checkbox\") {\n      v.checked && tempObj[v.name].push(v.value);\n    } else if (v.type === \"file\") {\n      tempObj[v.name] = Array.prototype.slice.call(v.files);\n    } else {\n      tempObj[v.name] = v.value;\n    }\n  });\n\n  return tempObj;\n}\n\n/**\n * 将一个object转为对应键值对的 FormData 对象\n * @param obj\n * @returns fd - FormData对象\n */\nexport function obj2FormData(obj): FormData {\n  const keys = Object.keys(obj);\n  const form = new FormData();\n\n  keys.forEach((key) => {\n    if (Array.isArray(obj[key])) {\n      obj[key].forEach((val) => {\n        // form.append(`${key}[]`, val)\n        form.append(key, val);\n      });\n    } else if (obj[key]) {\n      form.append(key, obj[key]);\n    }\n  });\n\n  return form;\n}\n"],"names":["form2obj","obj2FormData","el","isDom","console","error","querySelectorAll","tempObj","inputs","Array","prototype","slice","call","forEach","v","name","type","checked","value","push","files","obj","keys","Object","form","FormData","key","isArray","val","append"],"mappings":"AAAA;mGAAsB,SAAS;;;QAAT,SAAS;;;;;;;;;;;;;;;QAYfA,QAAQ;mBAARA,QAAQ;;QA0CRC,YAAY;mBAAZA,YAAY;;;IA1CrB,SAASD,QAAQ,CAACE,EAAe,EAAa;QACnD,IAAI,CAACC,IAAAA,KAAK,MAAA,EAACD,EAAE,CAAC,EAAE;YACdE,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAC,CAAC;YAChD,OAAO,EAAE,CAAC;SACX;QACD,IAAI,CAACH,EAAE,CAACI,gBAAgB,EAAE;YACxBF,OAAO,CAACC,KAAK,CACX,iEAAiE,CAClE,CAAC;YACF,OAAO,EAAE,CAAC;SACX;QACD,IAAME,OAAO,GAAG,EAAE,AAAC;QACnB,IAAIC,MAAM,GAAQN,EAAE,CAACI,gBAAgB,CACnC,yCAAyC,CAC1C,AAAC;QACFE,MAAM,GAAGC,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACJ,MAAM,CAAC,CAAC;QAC5CA,MAAM,CAACK,OAAO,CAAC,SAACC,CAAC,EAAK;YACpB,aAAa;YACb,IAAI,CAACA,CAAC,CAACC,IAAI,EAAE,OAAO;YAEpB,IAAID,CAAC,CAACE,IAAI,KAAK,OAAO,IAAIF,CAAC,CAACE,IAAI,KAAK,UAAU,EAAE;gBAC/C,IAAI,CAACT,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,EAAER,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACE,IAAI,KAAK,UAAU,GAAG,EAAE,GAAG,EAAE,CAAC;aACzE;YACD,IAAIF,CAAC,CAACE,IAAI,KAAK,OAAO,EAAE;gBACtBF,CAAC,CAACG,OAAO,IAAI,CAACV,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACI,KAAK,CAAC,CAAC;aAC1C,MAAM,IAAIJ,CAAC,CAACE,IAAI,KAAK,UAAU,EAAE;gBAChCF,CAAC,CAACG,OAAO,IAAIV,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,CAACI,IAAI,CAACL,CAAC,CAACI,KAAK,CAAC,CAAC;aAC5C,MAAM,IAAIJ,CAAC,CAACE,IAAI,KAAK,MAAM,EAAE;gBAC5BT,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGN,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACE,CAAC,CAACM,KAAK,CAAC,CAAC;aACvD,MAAM;gBACLb,OAAO,CAACO,CAAC,CAACC,IAAI,CAAC,GAAGD,CAAC,CAACI,KAAK,CAAC;aAC3B;SACF,CAAC,CAAC;QAEH,OAAOX,OAAO,CAAC;KAChB;IAOM,SAASN,YAAY,CAACoB,GAAG,EAAY;QAC1C,IAAMC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACD,GAAG,CAAC,AAAC;QAC9B,IAAMG,IAAI,GAAG,IAAIC,QAAQ,EAAE,AAAC;QAE5BH,IAAI,CAACT,OAAO,CAAC,SAACa,GAAG,EAAK;YACpB,IAAIjB,KAAK,CAACkB,OAAO,CAACN,GAAG,CAACK,GAAG,CAAC,CAAC,EAAE;gBAC3BL,GAAG,CAACK,GAAG,CAAC,CAACb,OAAO,CAAC,SAACe,GAAG,EAAK;oBACxB,+BAA+B;oBAC/BJ,IAAI,CAACK,MAAM,CAACH,GAAG,EAAEE,GAAG,CAAC,CAAC;iBACvB,CAAC,CAAC;aACJ,MAAM,IAAIP,GAAG,CAACK,GAAG,CAAC,EAAE;gBACnBF,IAAI,CAACK,MAAM,CAACH,GAAG,EAAEL,GAAG,CAACK,GAAG,CAAC,CAAC,CAAC;aAC5B;SACF,CAAC,CAAC;QAEH,OAAOF,IAAI,CAAC;KACb"}