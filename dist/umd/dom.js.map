{"version":3,"sources":["/Users/lixianjie/project/openSource/utils/src/dom.ts"],"sourcesContent":["import { Bound, TupleNumber } from \"./common-type.js\";\nimport { isDom, isNumber } from \"./is.js\";\nimport { clamp } from \"./number.js\";\n\nconst portalsID = \"J__PORTALS__NODE__\";\n\n/**\n * get a dom, multiple calls will return the same dom\n * @param namespace - create a uniq node by namespace\n * @return - dom\n * */\nexport const getPortalsNode = (namespace?: string): HTMLDivElement => {\n  const id =\n    portalsID + (namespace ? namespace.toLocaleUpperCase() : \"DEFAULT\");\n\n  let portalsEl = document.getElementById(id);\n\n  if (!portalsEl) {\n    const el = document.createElement(\"div\");\n    el.id = id;\n    portalsEl = document.body.appendChild(el);\n  }\n  return portalsEl as HTMLDivElement;\n};\n\n/**\n * get scrollbar width\n * @param className - If the element customizes the scroll bar through css, pass in the class name for customization\n * @return scroll - bar [x, y] width, generally 0 on mobile, unless you customize the scroll bar\n * */\nexport function getScrollBarWidth(className?: string): TupleNumber {\n  // Create the measurement node\n  const scrollEl = document.createElement(\"div\");\n  if (className) scrollEl.className = className;\n  scrollEl.style.overflow = \"scroll\";\n  scrollEl.style.height = \"200px\";\n  scrollEl.style.width = \"200px\";\n  scrollEl.style.border = \"2px solid red\";\n\n  document.body.appendChild(scrollEl);\n\n  let wSize = scrollEl.offsetWidth - scrollEl.clientWidth;\n  let hSize = scrollEl.offsetWidth - scrollEl.clientWidth;\n\n  const sty = getStyle(scrollEl);\n\n  if (sty) {\n    const trimPXStr = (s) => s.replace(/px/, \"\");\n    wSize =\n      wSize - trimPXStr(sty.borderLeftWidth) - trimPXStr(sty.borderRightWidth);\n    hSize =\n      hSize - trimPXStr(sty.borderTopWidth) - trimPXStr(sty.borderBottomWidth);\n  }\n\n  document.body.removeChild(scrollEl);\n\n  // Get the scrollbar width\n  return [wSize, hSize];\n}\n\n/**\n * get style value of dom element\n * @param dom - target dom\n * @return - an object containing all available style values, an null means not supported\n *  */\nexport function getStyle(dom: HTMLElement): Partial<CSSStyleDeclaration> {\n  if (!dom) return {};\n  // @ts-ignore\n  if (!dom.currentStyle && !window.getComputedStyle) return {};\n  // @ts-ignore\n  return dom.currentStyle ? dom.currentStyle : window.getComputedStyle(dom);\n}\n\n/**\n * check if element is visible\n * @param target - an element to be detected or an object that represents location information\n * @param option\n * @param option.fullVisible - false | default is to be completely invisible, and set to true to be invisible if element is partially occluded\n * @param option.wrapEl - By default, the viewport computes visibility through this specified element (viewport is still detected)\n * @param option.offset - Offset of visibility, specifying all directions for numbers, and specific directions for object\n * @return - Whether the overall visibility information and the specified direction does not exceed the visible boundary\n * */\nexport function checkElementVisible(\n  target: HTMLElement | Partial<Bound>,\n  option: {\n    fullVisible?: boolean;\n    wrapEl?: HTMLElement;\n    offset?: number | Partial<Bound>;\n  } = {}\n): {\n  visible: boolean;\n  top: boolean;\n  left: boolean;\n  right: boolean;\n  bottom: boolean;\n  bound: Partial<Bound>;\n} {\n  const { fullVisible = false, wrapEl, offset = 0 } = option;\n\n  const ofs = getOffsetObj(offset);\n\n  // 核心是判定视口的可用区域所在的框，再检测元素是否在这个框坐标内\n\n  /** 基础边界(用于窗口) */\n  const yMinBase = 0;\n  const xMinBase = 0;\n  const yMaxBase = window.innerHeight;\n  const xMaxBase = window.innerWidth;\n\n  /** 有效边界 */\n  let aYMin = yMinBase;\n  let aXMin = xMinBase;\n  let aYMax = yMaxBase;\n  let aXMax = xMaxBase;\n\n  // 需要同时检测是否超出窗口、所在容器\n  if (wrapEl) {\n    const { top, left, bottom, right } = wrapEl.getBoundingClientRect();\n\n    const yMin = yMinBase + top;\n    const xMin = xMinBase + left;\n    const yMax = bottom;\n    const xMax = right; // 减去元素右边到视口右边\n\n    // 有效区域左上取最小值，最小不小于0\n    // 有效区域右下取最大值，最大不大于窗口对应方向尺寸\n    aXMin = clamp(Math.max(xMinBase, xMin), xMinBase, xMaxBase);\n    aYMin = clamp(Math.max(yMinBase, yMin), yMinBase, yMaxBase);\n    aXMax = clamp(Math.min(xMaxBase, xMax), xMinBase, xMaxBase);\n    aYMax = clamp(Math.min(yMaxBase, yMax), yMinBase, yMaxBase);\n  }\n\n  const bound = isDom(target) ? target.getBoundingClientRect() : target;\n\n  const { top, left, bottom, right } = offsetCalc(bound, ofs);\n\n  /** fullVisible检测 */\n  const topPos = fullVisible ? top : bottom;\n  const bottomPos = fullVisible ? bottom : top;\n  const leftPos = fullVisible ? left : right;\n  const rightPos = fullVisible ? right : left;\n\n  // 指定方向是否包含有效尺寸\n  const xFalse = aXMax === aXMin;\n  const yFalse = aYMax === aYMin;\n\n  const topVisible = yFalse ? false : topPos >= aYMin;\n  const leftVisible = xFalse ? false : leftPos >= aXMin;\n  const bottomVisible = yFalse ? false : bottomPos <= aYMax;\n  const rightVisible = xFalse ? false : rightPos <= aXMax;\n\n  return {\n    visible: topVisible && leftVisible && rightVisible && bottomVisible,\n    top: topVisible,\n    left: leftVisible,\n    right: rightVisible,\n    bottom: bottomVisible,\n    bound,\n  };\n}\n\n/** 用于checkElementVisible获取offset四个方向的值 */\nfunction getOffsetObj(offset) {\n  const ofs = { left: 0, top: 0, right: 0, bottom: 0 };\n\n  if (!offset) return ofs;\n\n  if (isNumber(offset)) {\n    return { left: offset, top: offset, right: offset, bottom: offset };\n  }\n\n  Object.keys(ofs).forEach((key) => {\n    if (isNumber(offset[key])) {\n      ofs[key] = offset[key];\n    }\n  });\n\n  return ofs;\n}\n\n/** 用于checkElement，计算offset对象和当前位置对象的最终值 */\nfunction offsetCalc(bound, offset) {\n  return {\n    top: bound.top - offset.top,\n    left: bound.left - offset.left,\n    right: bound.right + offset.right,\n    bottom: bound.bottom + offset.bottom,\n  };\n}\n\ninterface TriggerHighlightConf {\n  /** #1890ff | line color */\n  color: string;\n  /** true | use outline, if false use box-shadow */\n  useOutline: boolean;\n}\n\nexport function triggerHighlight(\n  target: HTMLElement,\n  TriggerHighlightConf?: TriggerHighlightConf\n): void;\nexport function triggerHighlight(\n  selector: string,\n  TriggerHighlightConf?: TriggerHighlightConf\n): void;\nexport function triggerHighlight(\n  t: string | HTMLElement,\n  TriggerHighlightConf?: TriggerHighlightConf\n): void;\nexport function triggerHighlight(t, conf) {\n  if (isDom(t)) {\n    mountHighlight(t, conf);\n  } else {\n    const temp = document.querySelectorAll(t);\n    if (temp.length) {\n      Array.from(temp).forEach((item) => mountHighlight(item, conf));\n    }\n  }\n}\n\nconst mountHighlightDefaultConf = {\n  color: \"#1890ff\",\n  useOutline: true,\n};\n\nfunction mountHighlight(target, conf = {}) {\n  const cf = {\n    ...mountHighlightDefaultConf,\n    ...conf,\n  };\n\n  if (cf.useOutline) {\n    target.style.outline = `1px auto ${cf.color}`;\n  } else {\n    target.style.boxShadow = `0 0 0 4px ${cf.color}`;\n  }\n\n  function clickHandle() {\n    if (cf.useOutline) {\n      target.style.outline = \"\";\n    } else {\n      target.style.boxShadow = \"\";\n    }\n\n    document.removeEventListener(\"click\", clickHandle);\n    document.removeEventListener(\"keydown\", clickHandle);\n  }\n\n  document.addEventListener(\"click\", clickHandle);\n  document.addEventListener(\"keydown\", clickHandle);\n}\n\n/**\n * Query the incoming Node for the presence of a specified node in all of its parent nodes\n * @param node - node to be queried\n * @param matcher - matcher, recursively receives the parent node and returns whether it matches\n * @param depth - maximum query depth\n * */\nexport function getCurrentParent(\n  node: Element,\n  matcher: (node: Element) => boolean,\n  depth?: number\n) {\n  let hasMatch = false;\n\n  let cDepth = 0;\n\n  function recur(n) {\n    if (depth) {\n      cDepth++;\n      if (cDepth === depth) return;\n    }\n\n    if (!n) {\n      return;\n    }\n    const pNode = n.parentNode;\n\n    if (pNode) {\n      const res = matcher(pNode);\n      if (res) {\n        hasMatch = true;\n        return;\n      }\n    }\n\n    recur(pNode);\n  }\n\n  recur(node);\n\n  return hasMatch;\n}\n\n/**\n * get scrolling parent node, get all when pass getAll\n * When setting or getting scrollTop/scrollLeft on document.documentElement and document.body, the performance of different browsers will be inconsistent, so when the scroll element is document.documentElement or document.body, document.documentElement is returned uniformly for easy identification\n * */\nexport function getScrollParent(\n  ele: HTMLElement,\n  getAll?: false\n): HTMLElement | null;\nexport function getScrollParent(\n  ele: HTMLElement,\n  getAll?: boolean\n): HTMLElement | HTMLElement[] | null;\nexport function getScrollParent(ele: HTMLElement, getAll?: boolean): any {\n  let node: any = getAll ? [] : null;\n\n  function handle(el) {\n    const parent = el.parentNode;\n\n    if (parent) {\n      const e = parent;\n      const h = e.clientHeight;\n      const sH = e.scrollHeight;\n\n      if (sH > h) {\n        const isRoot = e === document.documentElement || e === document.body;\n        const scrollStatus = hasScroll(e);\n\n        // 为body或doc时，统一取documentElement方便识别，部分浏览器支持body设置document.scrollXxx部分浏览器支持documentElement设置\n        const element = isRoot ? document.documentElement : e;\n\n        /* body和html元素不需要检测滚动属性 */\n        if (isRoot || scrollStatus.x || scrollStatus.y) {\n          if (getAll) {\n            if (isRoot) {\n              node.indexOf(document.documentElement) === -1 &&\n                node.push(element);\n            } else {\n              node.push(element);\n            }\n          } else {\n            node = element;\n            return;\n          }\n        }\n      }\n\n      handle(e);\n    } else {\n      // 无匹配\n    }\n  }\n\n  handle(ele);\n\n  return node;\n}\n\n/** get doc scroll offset, used to solve the problem of different versions of the browser to get inconsistent */\nexport function getDocScrollOffset() {\n  const doc = document.documentElement;\n  const body = document.body;\n\n  return {\n    // Math.ceil用于解决高分屏缩放时的滚动位置小数问题\n    x: Math.ceil(doc.scrollLeft + body.scrollLeft),\n    y: Math.ceil(doc.scrollTop + body.scrollTop),\n  };\n}\n\n/** set doc scroll offset */\nexport function setDocScrollOffset(conf: { x?: number; y?: number } = {}) {\n  if (isNumber(conf.x)) {\n    // eslint-disable-next-line\n    document.body.scrollLeft = document.documentElement.scrollLeft = conf.x;\n  }\n\n  if (isNumber(conf.y)) {\n    // eslint-disable-next-line\n    document.body.scrollTop = document.documentElement.scrollTop = conf.y;\n  }\n}\n\n/** check whether the dom node is scrollable */\nexport function hasScroll(el: HTMLElement): { x: boolean; y: boolean } {\n  let x = Math.max(0, el.scrollWidth - el.clientWidth) > 0;\n  let y = Math.max(0, el.scrollHeight - el.clientHeight) > 0;\n\n  if (el === document.documentElement || el === document.body) {\n    // ...\n  } else {\n    const { overflowX, overflowY } = getStyle(el);\n    if (overflowX !== \"scroll\" && overflowX !== \"auto\") {\n      x = false;\n    }\n    if (overflowY !== \"scroll\" && overflowY !== \"auto\") {\n      y = false;\n    }\n  }\n\n  return {\n    x,\n    y,\n  };\n}\n"],"names":["getPortalsNode","getScrollBarWidth","getStyle","checkElementVisible","triggerHighlight","getCurrentParent","getScrollParent","getDocScrollOffset","setDocScrollOffset","hasScroll","portalsID","namespace","id","toLocaleUpperCase","portalsEl","document","getElementById","el","createElement","body","appendChild","className","scrollEl","style","overflow","height","width","border","wSize","offsetWidth","clientWidth","hSize","sty","trimPXStr","s","replace","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","removeChild","dom","currentStyle","window","getComputedStyle","target","option","fullVisible","wrapEl","offset","ofs","getOffsetObj","yMinBase","xMinBase","yMaxBase","innerHeight","xMaxBase","innerWidth","aYMin","aXMin","aYMax","aXMax","getBoundingClientRect","top","left","bottom","right","yMin","xMin","yMax","xMax","clamp","Math","max","min","bound","isDom","offsetCalc","topPos","bottomPos","leftPos","rightPos","xFalse","yFalse","topVisible","leftVisible","bottomVisible","rightVisible","visible","isNumber","Object","keys","forEach","key","t","conf","mountHighlight","temp","querySelectorAll","length","Array","from","item","mountHighlightDefaultConf","color","useOutline","cf","outline","boxShadow","clickHandle","removeEventListener","addEventListener","node","matcher","depth","hasMatch","cDepth","recur","n","pNode","parentNode","res","ele","getAll","handle","parent","e","h","clientHeight","sH","scrollHeight","isRoot","documentElement","scrollStatus","element","x","y","indexOf","push","doc","ceil","scrollLeft","scrollTop","scrollWidth","overflowX","overflowY"],"mappings":"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"}